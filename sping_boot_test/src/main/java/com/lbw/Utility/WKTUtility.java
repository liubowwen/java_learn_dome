package com.lbw.Utility;

import com.alibaba.fastjson.JSON;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.geom.MultiPolygon;
import org.locationtech.jts.geom.Polygon;
import org.locationtech.jts.io.WKTReader;

import java.util.LinkedList;
import java.util.List;

public class WKTUtility {
    private static final WKTReader _reader = new WKTReader();

    /**
     * @param wkt                  wkt字符串
     * @param sourceCoordinateType 原始坐标系类型，0:WGS84,1:GCJ02,2:BD09
     * @param targetCoordinateType 目标坐标系类型，0:WGS84,1:GCJ02,2:BD09
     * @return 坐标点二维数组
     */
    public static List<List<GeoPoint>> wktMultiPolygonToGeoPointList(String wkt, int sourceCoordinateType, int targetCoordinateType) {
        List<List<GeoPoint>> polygonList = new LinkedList<>();
        try {
            Geometry geometry = _reader.read(wkt);
            if (geometry instanceof MultiPolygon) {
                MultiPolygon multiPolygon = (MultiPolygon) geometry;
                for (int i = 0; i <= multiPolygon.getNumGeometries() - 1; i++) {
                    List<GeoPoint> pointList = new LinkedList<>();
                    Geometry subGeometry = multiPolygon.getGeometryN(i);
                    if (subGeometry instanceof Polygon) {
                        Polygon polygon = (Polygon) subGeometry;
                        Coordinate[] coordinates = polygon.getCoordinates();
                        for (int j = 0; j <= coordinates.length - 1; j++) {
                            Coordinate coordinate = coordinates[j];
                            pointList.add(new GeoPoint(coordinate.x, coordinate.y, sourceCoordinateType, targetCoordinateType));
                        }
                    }
                    polygonList.add(pointList);
                }
            }
        } catch (Exception ex) {
            ex.printStackTrace();
        }
        return polygonList;
    }

    public static void main(String[] args) {
        String wkt = "MULTIPOLYGON(((120.91642101334 36.9222139633846,120.915878019669 36.9224923857714,120.913211903909 36.9215402015712,120.912012956479 36.9214999684359,120.911822519639 36.9212371119525,120.911363861897 36.9212961205508,120.911307535508 36.9215777524974,120.907667777875 36.9217360028292,120.907631280114 36.9222803433726,120.906540528549 36.9222445093046,120.905160538969 36.9217682074461,120.904142633689 36.9212574563871,120.903101936592 36.9218421779523,120.902924910797 36.9216973386655,120.902967826141 36.9215203128705,120.903004357994 36.921275865062,120.90285147208 36.9208912782558,120.902815262258 36.9205962352641,120.902966807068 36.9204540781864,120.902981559217 36.920174681414,120.903108964145 36.9199694924243,120.903629312694 36.9195631377586,120.903568962991 36.9160843126663,120.903645405948 36.9157356254943,120.903800974071 36.9154875211605,120.902815262258 36.9150758020767,120.902956078232 36.9146671356574,120.902939984977 36.9145477773563,120.903123716295 36.9144927920715,120.903239051283 36.9145799638644,120.903314153135 36.9145853282825,120.903603831709 36.9144029380695,120.903587738455 36.9142473699466,120.903432170332 36.9140649797336,120.903346339643 36.9137592079059,120.90343753475 36.9134588004962,120.903512636602 36.913415885152,120.903501907766 36.9131798507587,120.903383890569 36.9130940200702,120.903512636602 36.9129974605457,120.90349117893 36.9127721549884,120.903662840307 36.9126434089557,120.903920332372 36.9126112224475,120.904006163061 36.9122678996936,120.904381672323 36.9121391536609,120.904328028143 36.9119031192676,120.904188553274 36.9118172885791,120.903963247717 36.9114739658252,120.903813044012 36.9113666774646,120.903662840307 36.9114739658252,120.903458992422 36.9111628295795,120.90343753475 36.9109053375141,120.903201500356 36.9105834724323,120.903952518881 36.9093281986133,120.904027620733 36.9089634181873,120.904574791372 36.9090170623676,120.904714266241 36.9088775874988,120.904703537405 36.9086522819415,120.90485374111 36.908555722417,120.904639164388 36.9083518745319,120.904295841635 36.9080300094501,120.904102722585 36.9079549075977,120.903802315176 36.907654500188,120.903534094274 36.9074613811389,120.903288498081 36.9074194700303,120.903288498081 36.9073282749238,120.903534094274 36.9074613811389,120.90352991876 36.907126892831,120.903426805914 36.9069034816638,120.903405348242 36.9066674472705,120.903684297979 36.9061739208118,120.903534094274 36.9058735134021,120.903104940832 36.9057447673694,120.902749085332 36.9055012872902,120.902697245062 36.9054658176319,120.902890364111 36.9051010372058,120.90277829485 36.9043102876642,120.903027740288 36.9042807833651,120.905077327989 36.9038214306692,120.905313362382 36.9037597398619,120.906118025087 36.9033439974646,120.906726886533 36.9029094796042,120.906970967554 36.9031937937597,120.907188226484 36.9036229472021,120.907110442422 36.9037087778906,120.907502044939 36.9042961816649,120.907502044939 36.9044624786238,120.907799770139 36.9048835854391,120.907952656053 36.9050230603079,120.908118953012 36.9049828271727,120.908274521135 36.904856763349,120.908470322393 36.9047092418531,120.908625890516 36.9045429448942,120.908762683176 36.9044007878164,120.908896793626 36.9043525080542,120.909465421937 36.9038965325216,120.909819473527 36.9039179901938,120.910050143503 36.9040467362265,120.909508337282 36.9049372296194,120.909374226831 36.9053502898077,120.909401048921 36.9063373427252,120.909722914003 36.9071902851919,120.909969677232 36.9076194386343,120.910860170625 36.9074799637656,120.910886992715 36.9075389723639,120.911053289674 36.907475940452,120.911092181705 36.9075228791098,120.911113639377 36.9076435785154,120.911161919139 36.9076569895605,120.911198128961 36.9076422374109,120.911247749828 36.9076851527552,120.911384993554 36.907815690959,120.911622369052 36.9079699179773,120.911807441474 36.9080946406965,120.911882543326 36.9081697425489,120.911953621865 36.9082220456247,120.912042134763 36.9084258935098,120.912149423123 36.908632423604,120.91207700348 36.9087182542925,120.91214539981 36.9087558052187,120.912408256293 36.9087088665609,120.912578308007 36.9091980994575,120.912878715417 36.9092410148017,120.913329326531 36.9090693534248,120.913275682351 36.908929878556,120.913511716744 36.9087045729988,120.913619005105 36.9088976920478,120.913747751137 36.9089513362281,120.913897954842 36.9092517436378,120.91393014135 36.9095843375557,120.914101802727 36.9098525584571,120.914252006432 36.9095628798835,120.914541685006 36.909648710572,120.914509498498 36.9097399056785,120.914488040826 36.9098740161293,120.914804541489 36.9098793805473,120.915142499825 36.9099008382194,120.915276610276 36.9099652112358,120.915308796784 36.9100778640144,120.915271245858 36.9103138984077,120.915163957497 36.910372907006,120.915166639706 36.9104211867683,120.915236377141 36.9103970468872,120.915228330514 36.9105150640838,120.915300750157 36.9105016530388,120.915547513386 36.9105150640838,120.915518009087 36.9105552972191,120.915799641034 36.9106947720878,120.915984713456 36.9107403696411,120.916309260747 36.9107564628952,120.917367395875 36.9106652677887,120.917893108842 36.9104077757232,120.918086227891 36.9103970468872,120.918322262285 36.9100751818054,120.918676313875 36.9099786222809,120.918847975252 36.9098713339203,120.919180569169 36.9098713339203,120.919084009645 36.9099464357727,120.919202026842 36.910005444371,120.91920739126 36.9100751818054,120.919486340997 36.9100590885513,120.91956297554 36.9101502836578,120.919777552262 36.910187834584,120.919879476204 36.9102307499283,120.919943849221 36.9102146566742,120.920276443138 36.9100322664611,120.920480291024 36.9102039278381,120.920630494728 36.910187834584,120.920662681237 36.9100590885513,120.920894314109 36.9099207598904,120.920996238052 36.9099744040707,120.921076704322 36.9099636752346,120.921178628265 36.9100012261608,120.921264458953 36.9099422175625,120.921339560806 36.9098724801281,120.921414662658 36.9097437340954,120.921511222183 36.909668632243,120.921849180518 36.9095345217922,120.921849180518 36.9094594199398,120.922428537666 36.9095184285381,120.922439266502 36.9094325978497,120.922530461608 36.9094433266857,120.92252509719 36.9095613438824,120.922621656715 36.9095613438824,120.922712851821 36.9095291573742,120.92277186042 36.9095720727184,120.922723580657 36.9098993022183,120.922734309493 36.9100977856854,120.922680665313 36.910398193095,120.922766496001 36.9106556851604,120.922922064124 36.9106986005047,120.923013259231 36.9106610495785,120.923018623649 36.9102426249722,120.9231527341 36.9100119549969,120.923163462936 36.9098993022183,120.923254658042 36.9097866494396,120.923297573386 36.9096203524807,120.923367310821 36.9096096236446,120.923399497329 36.9094325978497,120.924338270484 36.9096096236446,120.924434830009 36.909679361079,120.924552847205 36.909845658038,120.924585033714 36.9102050740459,120.924670864402 36.9104089219311,120.925304098965 36.9096149880627,120.925615235211 36.9094272334316,120.925797625424 36.9094272334316,120.925840540768 36.9095291573742,120.925786896588 36.9096149880627,120.925776167752 36.9097008187511,120.925583048703 36.9100977856854,120.925443573834 36.9102050740459,120.925443573834 36.9103123624065,120.925218268277 36.9105323035458,120.92507342899 36.9107254225948,120.925196810605 36.9108005244472,120.925186081768 36.9109614569881,120.925121708752 36.9109990079144,120.925062700154 36.9111492116192,120.925068064572 36.9113047797421,120.925135119797 36.9113235552052,120.925006373764 36.9114978987911,120.924979551674 36.9115864116886,120.925159259678 36.9116105515698,120.925363107563 36.9117017466763,120.925392611863 36.9115649540165,120.925491853596 36.9114040214756,120.925636692883 36.9112779576519,120.925701065899 36.9111411649922,120.925800307633 36.9108756262997,120.925973522791 36.9105749511691,120.926241743692 36.9100599670383,120.926290023455 36.9097059154483,120.926214921602 36.9095986270877,120.926236379274 36.9091802024814,120.926499235758 36.9091962957355,120.92652069343 36.9087885999652,120.926896202692 36.9086813116046,120.926923024782 36.9087617778751,120.926826465258 36.9089602613422,120.926762092241 36.9093840503665,120.926815736422 36.9095825338336,120.926762092241 36.9099404055395,120.92676477445 36.9099806386747,120.926762092241 36.910036965064,120.926796960958 36.9100718337812,120.926767456659 36.9101683933057,120.926767456659 36.91021130865,120.926786232122 36.9102555650987,120.926772821077 36.9103306669511,120.926795619854 36.9105103749551,120.926813054213 36.9106914240636,120.926813054213 36.9108778375902,120.926775503286 36.9109743971147,120.926781978661 36.9110202731517,120.926910724694 36.9111852290061,120.926932182366 36.9111852290061,120.926983144337 36.911063188496,120.927046176249 36.9110068621067,120.927122619206 36.9110229553607,120.927184310013 36.911063188496,120.927227225357 36.9110564829734,120.927258070761 36.9110296608833,120.92724600082 36.91098406333,120.927307691628 36.9109076203731,120.927327808195 36.9108526350883,120.927307691628 36.9108284952072,120.927271481806 36.910701090279,120.927342976447 36.9104706054037,120.927451657999 36.9100291215873,120.927750724304 36.9101900541282,120.927789616335 36.9100318037963,120.928039061773 36.9100961768127,120.928076612699 36.90996743078,120.928153055656 36.9099660896755,120.928277778375 36.9100022994972,120.928346174705 36.9099580430484,120.92834751581 36.9099298798537,120.928390431154 36.9099030577636,120.928693221677 36.9099169828268,120.928732113707 36.9096916772695,120.928734795916 36.9095736600729,120.929346339572 36.9096541263433,120.929308788646 36.9097453214498,120.929123716223 36.9097453214498,120.929112987387 36.9098365165563,120.928978876937 36.9098606564375,120.92897083031 36.9099062539907,120.9289976524 36.909946487126,120.9289976524 36.910131559548,120.929217593539 36.9101208307119,120.929362432826 36.9101235129209,120.929374741778 36.9105535938774,120.929350601897 36.9111490442788,120.929406928286 36.9111570909058,120.929715382323 36.9118437364136,120.929795848593 36.9118839695488,120.929999696478 36.9118786051308,120.930128442511 36.911905427221,120.930343019232 36.9120127155815,120.930428849921 36.912093181852,120.930482494101 36.9122272923028,120.930380570158 36.9123238518273,120.930397537738 36.912371361051,120.930487858519 36.9124633266961,120.930652452054 36.9130771278877,120.931153046355 36.9129568531548,120.931233512625 36.9131499722039,120.931201326117 36.9132197096383,120.931222783789 36.9133001759087,120.931351529822 36.9137883379494,120.931094037756 36.9138741686379,120.931158410773 36.9141048386132,120.931287156805 36.9141799404656,120.931335436568 36.9143998816048,120.93141053842 36.9145500853096,120.931351529822 36.9147753908669,120.931399809584 36.9148504927193,120.931603657469 36.9148826792275,120.932016592493 36.9150538961888,120.931904064879 36.9169801666771,120.931732403502 36.9172269299065,120.931523191199 36.9176560833489,120.930958508637 36.9180052909498,120.930820452437 36.9181013300454,120.930332290396 36.9186216785942,120.929833399519 36.9186163141762,120.929602729544 36.9185304834877,120.929200398192 36.9184768393074,120.928760515913 36.9194075658356,120.927750664219 36.9193244173562,120.927750664219 36.9194250001942,120.927289324269 36.9194244660091,120.927246408924 36.9196497715664,120.926516848072 36.91958539855,120.926506119236 36.9211088932705,120.9271498494 36.9210552490902,120.927224951252 36.9215916908932,120.926248627171 36.9220530308437,120.92497189568 36.9218062676143,120.925411777958 36.9228684223842,120.925272303089 36.9229327954006,120.925347404942 36.9232010163021,120.923491316304 36.9233297623348,120.923426943287 36.9228576935482,120.9242637925 36.9227182186794,120.924231605992 36.9225036419582,120.924360352024 36.9224392689419,120.924177961811 36.9218599117946,120.923995571598 36.9218491829586,120.923995571598 36.9214200295162,120.922332602009 36.9206046379757,120.920111732945 36.9207548416805,120.918148355946 36.9215273178768,120.917611914143 36.9218599117946,120.91642101334 36.9222139633846,120.91642101334 36.9222139633846)))";        List<List<GeoPoint>> polygonList = wktMultiPolygonToGeoPointList(wkt, 0, 2);
        System.out.println(JSON.toJSONString(polygonList));
    }


    public static class GeoPoint {
        private Double lat;
        private Double lng;


        /**
         * @param x                    经度
         * @param y                    纬度
         * @param sourceCoordinateType 源数据坐标系类型,0:WGS84,1:GCJ02,2:BD09
         * @param targetCoordinateType 目标数据坐标系类型,0:WGS84,1:GCJ02,2:BD09
         */
        public GeoPoint(Double x, Double y, int sourceCoordinateType, int targetCoordinateType) {
            double[] point;
            if (sourceCoordinateType == 0 && targetCoordinateType == 1) {
                point = CoordinateUtility.gps84ToGcj02(y, x);
            } else if (sourceCoordinateType == 0 && targetCoordinateType == 2) {
                point = CoordinateUtility.gps84ToBd09(y, x);
            } else if (sourceCoordinateType == 1 && targetCoordinateType == 0) {
                point = CoordinateUtility.gcj02ToGps84(y, x);
            } else if (sourceCoordinateType == 1 && targetCoordinateType == 2) {
                point = CoordinateUtility.gcj02ToBd09(y, x);
            } else if (sourceCoordinateType == 2 && targetCoordinateType == 0) {
                point = CoordinateUtility.bd09ToGps84(y, x);
            } else if (sourceCoordinateType == 2 && targetCoordinateType == 1) {
                point = CoordinateUtility.bd09ToGcj02(y, x);
            } else {
                point = new double[]{y, x};
            }
            this.lng = point[1];
            this.lat = point[0];
        }

        public GeoPoint(Double x, Double y) {
            this.lng = x;
            this.lat = y;
        }

        public Double getLat() {
            return lat;
        }

        public void setLat(Double lat) {
            this.lat = lat;
        }

        public Double getLng() {
            return lng;
        }

        public void setLng(Double lng) {
            this.lng = lng;
        }
    }
}
